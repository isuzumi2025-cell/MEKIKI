# MEKIKI OCR - å•é¡Œåˆ†æãƒ¬ãƒãƒ¼ãƒˆ

**ä½œæˆæ—¥**: 2026-01-19
**å¯¾è±¡ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v1.0.0
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”´ Critical Issues Identified

---

## ğŸ“‹ ç›®æ¬¡

1. [ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼](#ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼)
2. [å•é¡Œ1: ç”»åƒè¡¨ç¤ºã‚µã‚¤ã‚ºã¨ãƒªãƒ³ã‚¯ãƒ¡ã‚½ãƒƒãƒ‰ã®æœ€é©åŒ–](#å•é¡Œ1-ç”»åƒè¡¨ç¤ºã‚µã‚¤ã‚ºã¨ãƒªãƒ³ã‚¯ãƒ¡ã‚½ãƒƒãƒ‰ã®æœ€é©åŒ–)
3. [å•é¡Œ2: ç¯„å›²é¸æŠã®è¡¨ç¤ºã¨æ‰‹å‹•ç·¨é›†](#å•é¡Œ2-ç¯„å›²é¸æŠã®è¡¨ç¤ºã¨æ‰‹å‹•ç·¨é›†)
4. [å•é¡Œ3: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒœã‚¿ãƒ³ã¨æ©Ÿèƒ½ã®èª¬æ˜](#å•é¡Œ3-ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒœã‚¿ãƒ³ã¨æ©Ÿèƒ½ã®èª¬æ˜)
5. [æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³](#æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³)
6. [ä»˜éŒ²: å½±éŸ¿ã‚’å—ã‘ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§](#ä»˜éŒ²-å½±éŸ¿ã‚’å—ã‘ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§)

---

## ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼

### ğŸ”´ Critical Issues (3ä»¶)
1. **ç”»åƒè¡¨ç¤ºã®ã‚ªãƒ•ã‚»ãƒƒãƒˆè¨ˆç®—ãŒæ©Ÿèƒ½ã—ã¦ã„ãªã„** â†’ Coverãƒ¢ãƒ¼ãƒ‰ã§ä¸­å¤®é…ç½®ã•ã‚Œãªã„
2. **ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç¯„å›²ç·¨é›†æ©Ÿèƒ½ãŒå®Ÿè£…ã•ã‚Œã¦ã„ãªã„** â†’ åˆ¥ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‹ãå¿…è¦ãŒã‚ã‚‹
3. **ä¸»è¦æ©Ÿèƒ½ã®67%ã®ã¿å®Ÿè£…** â†’ Exportã¨Saveæ©Ÿèƒ½ãŒæœªå®Ÿè£…

### ğŸ“Š èª¿æŸ»çµæœã‚µãƒãƒªãƒ¼

| ã‚«ãƒ†ã‚´ãƒª | å•é¡Œæ•° | é‡å¤§åº¦ | å½±éŸ¿ç¯„å›² |
|---------|--------|--------|----------|
| ç”»åƒè¡¨ç¤º | 5 | ğŸ”´ High | Canvasè¡¨ç¤ºå…¨ä½“ |
| ç¯„å›²é¸æŠ | 4 | ğŸŸ¡ Medium | é¸æŠæ“ä½œãƒ»ç·¨é›† |
| UIæ©Ÿèƒ½ | 3 | ğŸŸ¡ Medium | ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ |

### ğŸ¯ å„ªå…ˆåº¦

1. **æœ€å„ªå…ˆ**: ç”»åƒã‚ªãƒ•ã‚»ãƒƒãƒˆä¿®æ­£ï¼ˆCoverãƒ¢ãƒ¼ãƒ‰ä¸­å¤®é…ç½®ï¼‰
2. **é«˜**: ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç¯„å›²ç·¨é›†ã®å®Ÿè£…
3. **ä¸­**: Export Excel / Save Projectæ©Ÿèƒ½ã®å®Ÿè£…

---

## å•é¡Œ1: ç”»åƒè¡¨ç¤ºã‚µã‚¤ã‚ºã¨ãƒªãƒ³ã‚¯ãƒ¡ã‚½ãƒƒãƒ‰ã®æœ€é©åŒ–

### ğŸ“ å½±éŸ¿ã‚’å—ã‘ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«
- `app/gui/windows/advanced_comparison_view.py`
  - `_display_image()` (Lines 1249-1371)
  - `_display_image_smart()` (Lines 740-799)
- `app/sdk/canvas/transform.py`

---

### ğŸ” å•é¡Œ1-A: Coverãƒ¢ãƒ¼ãƒ‰ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆè¨ˆç®—ãŒç„¡åŠ¹

#### ç—‡çŠ¶
Coverãƒ¢ãƒ¼ãƒ‰ï¼ˆä½™ç™½ãªã—è¡¨ç¤ºï¼‰ã§ç”»åƒãŒä¸­å¤®é…ç½®ã•ã‚Œãšã€å¸¸ã«å·¦ä¸Š(0,0)ã‹ã‚‰è¡¨ç¤ºã•ã‚Œã‚‹ã€‚

#### æ ¹æœ¬åŸå› 

**ãƒ•ã‚¡ã‚¤ãƒ«**: `advanced_comparison_view.py:1318-1328`

```python
# ã‚ªãƒ•ã‚»ãƒƒãƒˆè¨ˆç®—ã¯å®Ÿè¡Œã•ã‚Œã‚‹ï¼ˆLines 1318-1325ï¼‰
if self._display_mode == "cover":
    new_w = int(img_w * scale_factor)
    new_h = int(img_h * scale_factor)
    offset_x = max(0, (new_w - canvas_w) // 2)
    offset_y = max(0, (new_h - canvas_h) // 2)
else:
    offset_x = offset_y = 0

# ã—ã‹ã—ã€ç”»åƒé…ç½®ã¯å¸¸ã«(0,0)ã«å›ºå®šï¼ˆLine 1328ï¼‰
canvas.create_image(0, 0, anchor="nw", image=photo, tags="image")
#                  ^^^^  â† ã‚ªãƒ•ã‚»ãƒƒãƒˆãŒåæ˜ ã•ã‚Œã¦ã„ãªã„ï¼
```

#### æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ
```python
# æ­£ã—ã„å®Ÿè£…ä¾‹
canvas.create_image(
    -offset_x,  # â† è² ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆã§ä¸­å¤®å¯„ã›
    -offset_y,
    anchor="nw",
    image=photo,
    tags="image"
)
```

#### å½±éŸ¿ç¯„å›²
- Coverãƒ¢ãƒ¼ãƒ‰ä½¿ç”¨æ™‚ã«ç”»åƒã®å·¦ä¸Šéƒ¨åˆ†ã®ã¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- åº§æ¨™å¤‰æ›ã‚·ã‚¹ãƒ†ãƒ ï¼ˆ`CanvasTransform`ï¼‰ã«ã¯æ­£ã—ã„ã‚ªãƒ•ã‚»ãƒƒãƒˆãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€é ˜åŸŸé¸æŠã®åº§æ¨™ã¯æ­£ã—ãè¨ˆç®—ã•ã‚Œã‚‹ãŒã€**è¦–è¦šçš„ã«ç”»åƒã¨é ˜åŸŸãŒã‚ºãƒ¬ã¦è¦‹ãˆã‚‹**

#### è§£æ±ºç­–

**ä¿®æ­£ç®‡æ‰€**: `advanced_comparison_view.py:1328`

```python
# ä¿®æ­£å‰
canvas.create_image(0, 0, anchor="nw", image=photo, tags="image")

# ä¿®æ­£å¾Œ
canvas.create_image(
    -offset_x,  # Coverãƒ¢ãƒ¼ãƒ‰æ™‚ã¯è² ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆ
    -offset_y,
    anchor="nw",
    image=photo,
    tags="image"
)
```

**è¿½åŠ ä¿®æ­£**: `advanced_comparison_view.py:1332-1333`

```python
# ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é ˜åŸŸã‚‚ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’è€ƒæ…®
canvas.configure(scrollregion=(
    -offset_x,
    -offset_y,
    new_width - offset_x,
    new_height - offset_y
))
```

---

### ğŸ” å•é¡Œ1-B: Canvas ã‚µã‚¤ã‚ºæ¤œå‡ºã®ä¿¡é ¼æ€§

#### ç—‡çŠ¶
Canvas ã‚µã‚¤ã‚ºå–å¾—ã«3æ®µéšã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒã‚ã‚Šã€æ­£ç¢ºãªã‚µã‚¤ã‚ºãŒå–å¾—ã§ããªã„å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚

#### æ ¹æœ¬åŸå› 

**ãƒ•ã‚¡ã‚¤ãƒ«**: `advanced_comparison_view.py:1266-1275`

```python
# 1st try: winfo_width()
canvas_w = canvas.winfo_width()
canvas_h = canvas.winfo_height()

# 2nd fallback: å›ºå®šå€¤ 800x600
if canvas_w <= 1 or canvas_h <= 1:
    canvas_w = 800
    canvas_h = 600

# 3rd fallback: ã‚¤ãƒ™ãƒ³ãƒˆæ™‚ã®ã‚µã‚¤ã‚º
if event and hasattr(event, 'width'):
    canvas_w = event.width
    canvas_h = event.height
```

#### å•é¡Œç‚¹
1. ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦åˆæœŸåŒ–ç›´å¾Œã¯ `winfo_width()` ãŒ 1 ã‚’è¿”ã™ï¼ˆTkinterã®ä»•æ§˜ï¼‰
2. å›ºå®šå€¤800x600ã¯å®Ÿéš›ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºã¨ç•°ãªã‚‹å¯èƒ½æ€§
3. ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯é †åºãŒä¸é©åˆ‡ï¼ˆeventã‚’æœ€å¾Œã«ãƒã‚§ãƒƒã‚¯ã™ã¹ãï¼‰

#### è§£æ±ºç­–

```python
def _get_canvas_size(self, canvas: tk.Canvas, event=None) -> Tuple[int, int]:
    """Canvas ã‚µã‚¤ã‚ºã‚’ç¢ºå®Ÿã«å–å¾—"""

    # 1. ã‚¤ãƒ™ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’å„ªå…ˆï¼ˆæœ€æ–°ã®å€¤ï¼‰
    if event and hasattr(event, 'width') and event.width > 1:
        return event.width, event.height

    # 2. update_idletasks()ã§å¼·åˆ¶æ›´æ–°ã—ã¦ã‹ã‚‰å–å¾—
    canvas.update_idletasks()
    w, h = canvas.winfo_width(), canvas.winfo_height()

    if w > 1 and h > 1:
        return w, h

    # 3. è¦ªãƒ•ãƒ¬ãƒ¼ãƒ ã‚µã‚¤ã‚ºã‹ã‚‰æ¨å®š
    parent_w = canvas.master.winfo_width()
    parent_h = canvas.master.winfo_height()

    if parent_w > 1 and parent_h > 1:
        return parent_w - 20, parent_h - 20  # ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°è€ƒæ…®

    # 4. æœ€çµ‚ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆç”»é¢ã®50%ï¼‰
    screen_w = canvas.winfo_screenwidth()
    screen_h = canvas.winfo_screenheight()
    return screen_w // 2, screen_h // 2
```

---

### ğŸ” å•é¡Œ1-C: ãƒªã‚µã‚¤ã‚ºæ™‚ã®Debounceéå‰°

#### ç—‡çŠ¶
ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºæ™‚ã«ç”»åƒå†æç”»ãŒé…å»¶ã™ã‚‹ï¼ˆ300msï¼‰ã€‚

#### æ ¹æœ¬åŸå› 

**ãƒ•ã‚¡ã‚¤ãƒ«**: `advanced_comparison_view.py:671-701`

```python
def _on_canvas_resize(self, event):
    # 300msã®Debounceï¼ˆLine 680ï¼‰
    if self._resize_job:
        self.after_cancel(self._resize_job)

    self._resize_job = self.after(300, lambda: self._do_resize(event))
    #                              ^^^ 300mså¾…æ©Ÿ
```

#### å•é¡Œç‚¹
- 300msã¯ä½“æ„Ÿçš„ã«é…ã„ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒªã‚µã‚¤ã‚ºå®Œäº†ã—ã¦ã‹ã‚‰0.3ç§’å¾…ã¤ï¼‰
- ã‚µã‚¤ã‚ºå¤‰åŒ–ãŒ10pxæœªæº€ã®å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ï¼ˆLines 686-690ï¼‰â†’ å¾®èª¿æ•´ãŒåæ˜ ã•ã‚Œãªã„

#### è§£æ±ºç­–

```python
def _on_canvas_resize(self, event):
    """ãƒªã‚µã‚¤ã‚ºã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ï¼ˆæœ€é©åŒ–ç‰ˆï¼‰"""

    # Debounceã‚’150msã«çŸ­ç¸®
    if self._resize_job:
        self.after_cancel(self._resize_job)

    self._resize_job = self.after(150, lambda: self._do_resize(event))

def _do_resize(self, event):
    """ãƒªã‚µã‚¤ã‚ºå®Ÿè¡Œï¼ˆã‚µã‚¤ã‚ºå¤‰åŒ–é–¾å€¤ã‚’5pxã«ç·©å’Œï¼‰"""
    canvas = event.widget
    new_w, new_h = event.width, event.height

    # 5pxä»¥ä¸Šã®å¤‰åŒ–ã§å†æç”»ï¼ˆå¾“æ¥ã¯10pxï¼‰
    if abs(new_w - self._last_size.get(canvas, (0, 0))[0]) > 5 or \
       abs(new_h - self._last_size.get(canvas, (0, 0))[1]) > 5:
        self._display_image_smart(canvas, ...)
        self._last_size[canvas] = (new_w, new_h)
```

---

### ğŸ” å•é¡Œ1-D: åº§æ¨™å¤‰æ›ã‚·ã‚¹ãƒ†ãƒ ã®è¤‡é›‘æ€§

#### ç—‡çŠ¶
ç”»åƒåº§æ¨™ï¼ˆSourceï¼‰ã¨Canvasåº§æ¨™ï¼ˆViewï¼‰ã®å¤‰æ›ãŒè¤‡é›‘ã§ã€èª¤å·®ãŒç™ºç”Ÿã—ã‚„ã™ã„ã€‚

#### ç¾åœ¨ã®å®Ÿè£…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `advanced_comparison_view.py:1343-1356`

```python
from app.sdk.canvas.transform import CanvasTransform

canvas._coord_tf = CanvasTransform(
    scale_x=scale_factor,
    scale_y=scale_factor,
    offset_x=offset_x,  # Coverãƒ¢ãƒ¼ãƒ‰æ™‚ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆ
    offset_y=offset_y
)
```

**å¤‰æ›ãƒ¡ã‚½ãƒƒãƒ‰**: `app/sdk/canvas/transform.py`

```python
def src_to_view(self, sx, sy):
    """Source â†’ View åº§æ¨™å¤‰æ›"""
    vx = round(sx * self.scale_x - self.offset_x)
    vy = round(sy * self.scale_y - self.offset_y)
    return (vx, vy)

def view_to_src(self, vx, vy):
    """View â†’ Source åº§æ¨™å¤‰æ›"""
    sx = round((vx + self.offset_x) / self.scale_x)
    sy = round((vy + self.offset_y) / self.scale_y)
    return (sx, sy)
```

#### å•é¡Œç‚¹
1. **ã‚ªãƒ•ã‚»ãƒƒãƒˆç¬¦å·ã®ä¸ä¸€è‡´**:
   - `_display_image()` ã§è¨ˆç®—ã•ã‚Œã‚‹offsetã¯ã€Œç”»åƒãŒCanvasã‹ã‚‰ã¯ã¿å‡ºã™é‡ã€
   - `CanvasTransform` ã§ã¯ã€Œç”»åƒé…ç½®ã‚ªãƒ•ã‚»ãƒƒãƒˆã€ã¨ã—ã¦ä½¿ç”¨
   - ç¬¦å·ãŒé€†è»¢ã—ã¦ã„ã‚‹å¯èƒ½æ€§

2. **åº§æ¨™ç³»ã®æ··ä¹±**:
   - Canvasåº§æ¨™: `canvasx()`, `canvasy()` ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è€ƒæ…®
   - Viewåº§æ¨™: ç”»åƒä¸Šã®è¡¨ç¤ºåº§æ¨™
   - Sourceåº§æ¨™: å…ƒç”»åƒã®åº§æ¨™
   - 3ã¤ã®åº§æ¨™ç³»ãŒæ··åœ¨

#### è§£æ±ºç­–

**çµ±ä¸€åº§æ¨™ç³»ã®å®šç¾©**:

```python
# åº§æ¨™ç³»ã®æ˜ç¢ºãªå®šç¾©
# 1. Source (å…ƒç”»åƒ): (0, 0) ã€œ (image_width, image_height)
# 2. Scaled (æ‹¡å¤§ç¸®å°å¾Œ): (0, 0) ã€œ (scaled_width, scaled_height)
# 3. View (Canvasè¡¨ç¤º): (-offset_x, -offset_y) ã€œ (scaled_width - offset_x, scaled_height - offset_y)
# 4. Canvas (ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è€ƒæ…®): canvasx(), canvasy()ã§å–å¾—

class UnifiedCoordinateTransform:
    """çµ±ä¸€åº§æ¨™å¤‰æ›ã‚·ã‚¹ãƒ†ãƒ """

    def __init__(self, source_size, canvas_size, mode="fit"):
        self.src_w, self.src_h = source_size
        self.canvas_w, self.canvas_h = canvas_size
        self.mode = mode

        # ã‚¹ã‚±ãƒ¼ãƒ«è¨ˆç®—
        scale_x = self.canvas_w / self.src_w
        scale_y = self.canvas_h / self.src_h

        if mode == "fit":
            self.scale = min(scale_x, scale_y)
            self.offset_x = 0
            self.offset_y = 0
        else:  # cover
            self.scale = max(scale_x, scale_y)
            scaled_w = self.src_w * self.scale
            scaled_h = self.src_h * self.scale
            # ã‚ªãƒ•ã‚»ãƒƒãƒˆ = ã¯ã¿å‡ºã—é‡ã®åŠåˆ†ï¼ˆä¸­å¤®å¯„ã›ï¼‰
            self.offset_x = (scaled_w - self.canvas_w) / 2
            self.offset_y = (scaled_h - self.canvas_h) / 2

    def source_to_canvas(self, sx, sy):
        """Source â†’ Canvas åº§æ¨™ï¼ˆä¸€æ®µéšå¤‰æ›ï¼‰"""
        # Source â†’ Scaled
        scaled_x = sx * self.scale
        scaled_y = sy * self.scale

        # Scaled â†’ Canvas (ã‚ªãƒ•ã‚»ãƒƒãƒˆé©ç”¨)
        canvas_x = scaled_x - self.offset_x
        canvas_y = scaled_y - self.offset_y

        return round(canvas_x), round(canvas_y)

    def canvas_to_source(self, cx, cy):
        """Canvas â†’ Source åº§æ¨™"""
        # Canvas â†’ Scaled (ã‚ªãƒ•ã‚»ãƒƒãƒˆé™¤å»)
        scaled_x = cx + self.offset_x
        scaled_y = cy + self.offset_y

        # Scaled â†’ Source
        source_x = scaled_x / self.scale
        source_y = scaled_y / self.scale

        return round(source_x), round(source_y)
```

---

### ğŸ” å•é¡Œ1-E: é ˜åŸŸçŸ©å½¢ã®å†æç”»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

#### ç—‡çŠ¶
é ˜åŸŸãŒå¤šã„ï¼ˆ100+ï¼‰å ´åˆã€`_redraw_regions()` ãŒé…ã„ã€‚

#### æ ¹æœ¬åŸå› 

**ãƒ•ã‚¡ã‚¤ãƒ«**: `advanced_comparison_view.py:1408-1439`

```python
def _redraw_regions(self):
    """ã‚¨ãƒªã‚¢çŸ©å½¢ã‚’å†æç”»"""
    # ã™ã¹ã¦ã®é ˜åŸŸã‚’æ¯å›å‰Šé™¤ãƒ»å†ä½œæˆ
    for canvas in [self.web_canvas, self.pdf_canvas]:
        canvas.delete("region_rect")  # å…¨å‰Šé™¤

    # å…¨é ˜åŸŸã‚’å†æç”»
    for region in all_regions:
        # åº§æ¨™å¤‰æ›
        transform = get_canvas_transform(canvas)
        vx1, vy1, vx2, vy2 = transform.src_rect_to_view(...)

        # çŸ©å½¢ä½œæˆ
        canvas.create_rectangle(vx1, vy1, vx2, vy2, ...)
```

#### å•é¡Œç‚¹
- é ˜åŸŸæ•° N ã«å¯¾ã—ã¦ O(N) ã®å‰Šé™¤ãƒ»å†ä½œæˆ
- 100é ˜åŸŸ Ã— 2ã‚­ãƒ£ãƒ³ãƒã‚¹ = 200å›ã®æç”»æ“ä½œ

#### è§£æ±ºç­–

**å·®åˆ†æ›´æ–°ã®å®Ÿè£…**:

```python
def _redraw_regions(self):
    """é ˜åŸŸçŸ©å½¢ã®å·®åˆ†å†æç”»"""

    for canvas, regions, region_ids in [
        (self.web_canvas, self.web_regions, self._web_region_ids),
        (self.pdf_canvas, self.pdf_regions, self._pdf_region_ids)
    ]:
        transform = get_canvas_transform(canvas)

        # æ—¢å­˜ã®é ˜åŸŸIDé›†åˆ
        current_ids = set(region_ids.keys())
        new_ids = {r.id for r in regions}

        # å‰Šé™¤ã•ã‚ŒãŸé ˜åŸŸã®ã¿å‰Šé™¤
        for removed_id in current_ids - new_ids:
            canvas.delete(region_ids[removed_id])
            del region_ids[removed_id]

        # æ–°è¦ãƒ»æ›´æ–°ã•ã‚ŒãŸé ˜åŸŸã®ã¿å†æç”»
        for region in regions:
            vx1, vy1, vx2, vy2 = transform.src_rect_to_view(*region.rect)

            if region.id in region_ids:
                # æ—¢å­˜ã®çŸ©å½¢ã‚’æ›´æ–°
                canvas.coords(region_ids[region.id], vx1, vy1, vx2, vy2)
                canvas.itemconfig(region_ids[region.id], outline=color)
            else:
                # æ–°è¦çŸ©å½¢ã‚’ä½œæˆ
                rect_id = canvas.create_rectangle(
                    vx1, vy1, vx2, vy2,
                    outline=color,
                    width=2,
                    tags="region_rect"
                )
                region_ids[region.id] = rect_id
```

---

## å•é¡Œ2: ç¯„å›²é¸æŠã®è¡¨ç¤ºã¨æ‰‹å‹•ç·¨é›†

### ğŸ“ å½±éŸ¿ã‚’å—ã‘ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«
- `app/gui/windows/advanced_comparison_view.py`
  - `_on_canvas_click()` (Lines 2506-2520)
  - `_on_canvas_drag()` (Lines 2522-2542)
  - `_on_canvas_release()` (Lines 2544-2583)
- `app/gui/windows/region_editor.py` (åˆ¥ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦)
- `app/gui/windows/comparison_mixins/selection_mixin.py`

---

### ğŸ” å•é¡Œ2-A: ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†æ©Ÿèƒ½ã®æ¬ å¦‚

#### ç—‡çŠ¶
é¸æŠã—ãŸé ˜åŸŸã‚’ãã®å ´ã§ç·¨é›†ï¼ˆç§»å‹•ãƒ»ãƒªã‚µã‚¤ã‚ºï¼‰ã§ããšã€åˆ¥ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ï¼ˆRegionEditorï¼‰ã‚’é–‹ãå¿…è¦ãŒã‚ã‚‹ã€‚

#### ç¾åœ¨ã®å‹•ä½œãƒ•ãƒ­ãƒ¼

1. **é¸æŠä½œæˆ**: `_on_canvas_click()` â†’ `_on_canvas_drag()` â†’ `_on_canvas_release()`
2. **é ˜åŸŸç¢ºå®š**: `EditableRegion` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
3. **ç·¨é›†**: `region_editor.py` ã§åˆ¥ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‹ãå¿…è¦

#### æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ
- é¸æŠæ¸ˆã¿é ˜åŸŸã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ ãƒãƒ³ãƒ‰ãƒ«è¡¨ç¤º
- ãƒãƒ³ãƒ‰ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚° â†’ ãƒªã‚µã‚¤ã‚º
- é ˜åŸŸå†…éƒ¨ã‚’ãƒ‰ãƒ©ãƒƒã‚° â†’ ç§»å‹•
- Deleteã‚­ãƒ¼ â†’ å‰Šé™¤

#### æ ¹æœ¬åŸå› 

**ãƒ•ã‚¡ã‚¤ãƒ«**: `advanced_comparison_view.py:2506-2583`

```python
# é¸æŠã®ä½œæˆã¯å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ãŒ...
def _on_canvas_click(self, event):
    self._selection_start = (x, y)

def _on_canvas_drag(self, event):
    # é¸æŠçŸ©å½¢ã‚’è¡¨ç¤º
    canvas.create_rectangle(..., tags="selection_rect")

def _on_canvas_release(self, event):
    # é ˜åŸŸã‚’ç¢ºå®š
    region = EditableRegion(...)
    self.web_regions.append(region)

# âš ï¸ ç·¨é›†æ©Ÿèƒ½ãŒå®Ÿè£…ã•ã‚Œã¦ã„ãªã„
# - é¸æŠæ¸ˆã¿é ˜åŸŸã®æ¤œå‡ºãªã—
# - ãƒãƒ³ãƒ‰ãƒ«è¡¨ç¤ºãªã—
# - ãƒ‰ãƒ©ãƒƒã‚°ç·¨é›†ãªã—
```

#### è§£æ±ºç­–

**ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã®å®Ÿè£…**:

```python
class InlineRegionEditor:
    """Canvasä¸Šã§ç›´æ¥é ˜åŸŸã‚’ç·¨é›†"""

    def __init__(self, canvas: tk.Canvas):
        self.canvas = canvas
        self.selected_region: Optional[EditableRegion] = None
        self.edit_mode: Optional[str] = None  # "move", "resize_nw", etc.
        self.drag_start: Optional[Tuple[int, int]] = None

        # ã‚¤ãƒ™ãƒ³ãƒˆãƒã‚¤ãƒ³ãƒ‰
        canvas.bind("<Button-1>", self._on_click)
        canvas.bind("<B1-Motion>", self._on_drag)
        canvas.bind("<ButtonRelease-1>", self._on_release)
        canvas.bind("<Delete>", self._on_delete)

    def _on_click(self, event):
        """ã‚¯ãƒªãƒƒã‚¯å‡¦ç†: é ˜åŸŸé¸æŠã¨ãƒãƒ³ãƒ‰ãƒ«æ¤œå‡º"""
        x, y = event.x, event.y

        # 1. ãƒãƒ³ãƒ‰ãƒ«ã‚¯ãƒªãƒƒã‚¯ãƒã‚§ãƒƒã‚¯
        if self.selected_region:
            handle = self._get_handle_at(x, y)
            if handle:
                self.edit_mode = f"resize_{handle}"
                self.drag_start = (x, y)
                return

        # 2. é ˜åŸŸã‚¯ãƒªãƒƒã‚¯ãƒã‚§ãƒƒã‚¯
        clicked_region = self._get_region_at(x, y)
        if clicked_region:
            self._select_region(clicked_region)
            self.edit_mode = "move"
            self.drag_start = (x, y)
        else:
            self._deselect()

    def _on_drag(self, event):
        """ãƒ‰ãƒ©ãƒƒã‚°å‡¦ç†: ç§»å‹•ãƒ»ãƒªã‚µã‚¤ã‚º"""
        if not self.selected_region or not self.edit_mode:
            return

        dx = event.x - self.drag_start[0]
        dy = event.y - self.drag_start[1]

        if self.edit_mode == "move":
            # é ˜åŸŸã‚’ç§»å‹•
            self._move_region(dx, dy)
        elif self.edit_mode.startswith("resize_"):
            # é ˜åŸŸã‚’ãƒªã‚µã‚¤ã‚º
            handle = self.edit_mode.split("_")[1]
            self._resize_region(handle, dx, dy)

        # ãƒãƒ³ãƒ‰ãƒ«ã‚’å†æç”»
        self._draw_handles()

    def _select_region(self, region: EditableRegion):
        """é ˜åŸŸã‚’é¸æŠã—ã¦ãƒãƒ³ãƒ‰ãƒ«ã‚’è¡¨ç¤º"""
        self.selected_region = region

        # ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º
        self.canvas.itemconfig(region.canvas_rect_id, width=3, outline="#00FF00")

        # ãƒãƒ³ãƒ‰ãƒ«æç”»
        self._draw_handles()

    def _draw_handles(self):
        """ãƒªã‚µã‚¤ã‚ºãƒãƒ³ãƒ‰ãƒ«ã‚’æç”»ï¼ˆ8æ–¹å‘ï¼‰"""
        if not self.selected_region:
            return

        # æ—¢å­˜ã®ãƒãƒ³ãƒ‰ãƒ«ã‚’å‰Šé™¤
        self.canvas.delete("resize_handle")

        x1, y1, x2, y2 = self.selected_region.rect

        # 8ã¤ã®ãƒãƒ³ãƒ‰ãƒ«ä½ç½®
        handles = {
            "nw": (x1, y1), "n": ((x1+x2)//2, y1), "ne": (x2, y1),
            "w": (x1, (y1+y2)//2),               "e": (x2, (y1+y2)//2),
            "sw": (x1, y2), "s": ((x1+x2)//2, y2), "se": (x2, y2),
        }

        for handle_name, (hx, hy) in handles.items():
            self.canvas.create_rectangle(
                hx-4, hy-4, hx+4, hy+4,
                fill="#00FF00",
                outline="#FFFFFF",
                tags=("resize_handle", f"handle_{handle_name}")
            )
```

**çµ±åˆæ–¹æ³•**:

```python
# advanced_comparison_view.py ã® __init__ ã§åˆæœŸåŒ–
self._web_editor = InlineRegionEditor(self.web_canvas)
self._pdf_editor = InlineRegionEditor(self.pdf_canvas)
```

---

### ğŸ” å•é¡Œ2-B: é¸æŠãƒ¢ãƒ¼ãƒ‰ã®åˆ‡ã‚Šæ›¿ãˆãŒä¸æ˜ç­

#### ç—‡çŠ¶
Quick ãƒ¢ãƒ¼ãƒ‰ï¼ˆç°¡æ˜“OCRï¼‰ã¨ Full ãƒ¢ãƒ¼ãƒ‰ï¼ˆå®Œå…¨OCRï¼‰ã®åˆ‡ã‚Šæ›¿ãˆæ–¹æ³•ãŒUIã«è¡¨ç¤ºã•ã‚Œã¦ã„ãªã„ã€‚

#### ç¾åœ¨ã®å®Ÿè£…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `comparison_mixins/selection_mixin.py:33-51`

```python
self._selection_manager = SelectionManager(
    on_selection_complete=self._on_selection_complete,
    on_text_extracted=self._on_text_extracted,
    on_sync_complete=self._on_sync_complete,
    mode=SelectionMode.QUICK  # â† ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹
)
```

#### å•é¡Œç‚¹
- ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ãƒœã‚¿ãƒ³ãŒãªã„
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯Quick/Fullã®é•ã„ã‚’çŸ¥ã‚‰ãªã„
- å¸¸ã«Quickãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œ

#### è§£æ±ºç­–

**ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿UIã®è¿½åŠ **:

```python
# navigation_panel.py ã«ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³è¿½åŠ 
def _create_mode_toggle(self):
    """é¸æŠãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ãƒœã‚¿ãƒ³"""
    mode_frame = ctk.CTkFrame(self)
    mode_frame.pack(fill="x", padx=10, pady=5)

    ctk.CTkLabel(
        mode_frame,
        text="é¸æŠãƒ¢ãƒ¼ãƒ‰:",
        font=("Meiryo", 11)
    ).pack(side="left", padx=5)

    self.mode_var = tk.StringVar(value="quick")

    quick_radio = ctk.CTkRadioButton(
        mode_frame,
        text="âš¡ Quick (é«˜é€Ÿ)",
        variable=self.mode_var,
        value="quick",
        command=self._on_mode_change
    )
    quick_radio.pack(side="left", padx=5)

    full_radio = ctk.CTkRadioButton(
        mode_frame,
        text="ğŸ” Full (é«˜ç²¾åº¦)",
        variable=self.mode_var,
        value="full",
        command=self._on_mode_change
    )
    full_radio.pack(side="left", padx=5)

def _on_mode_change(self):
    """ãƒ¢ãƒ¼ãƒ‰å¤‰æ›´ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯"""
    mode = SelectionMode.QUICK if self.mode_var.get() == "quick" else SelectionMode.FULL
    self.callbacks.get("set_selection_mode", lambda m: None)(mode)
```

---

### ğŸ” å•é¡Œ2-C: é¸æŠçŸ©å½¢ã®è¦–è¦šãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ä¸è¶³

#### ç—‡çŠ¶
é¸æŠä¸­ã®çŸ©å½¢ãŒç‚¹ç·šã§è¡¨ç¤ºã•ã‚Œã‚‹ãŒã€ç¢ºå®šå¾Œã®çŠ¶æ…‹ãŒåˆ†ã‹ã‚Šã«ãã„ã€‚

#### ç¾åœ¨ã®å®Ÿè£…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `advanced_comparison_view.py:2537-2542`

```python
# ãƒ‰ãƒ©ãƒƒã‚°ä¸­: ç·‘ã®ç‚¹ç·š
canvas.create_rectangle(
    x1, y1, x, y,
    outline="#00FF00",
    width=2,
    dash=(4, 2),  # ç‚¹ç·š
    tags="selection_rect"
)
```

**ãƒ•ã‚¡ã‚¤ãƒ«**: `advanced_comparison_view.py:2579`

```python
# ç¢ºå®šå¾Œ: ç·‘ã®å®Ÿç·š
canvas.itemconfig("selection_rect", outline="#4CAF50", dash=())
```

#### å•é¡Œç‚¹
- ç¢ºå®šå¾Œã‚‚åŒã˜ç·‘è‰²ã§åŒºåˆ¥ã—ã¥ã‚‰ã„
- é¸æŠä¸­ãƒ»ç¢ºå®šæ¸ˆã¿ãƒ»ã‚·ãƒ³ã‚¯æ¸ˆã¿ã®çŠ¶æ…‹ãŒè¦–è¦šçš„ã«ä¸æ˜

#### è§£æ±ºç­–

**è‰²åˆ†ã‘ãƒ«ãƒ¼ãƒ«**:

```python
SELECTION_COLORS = {
    "dragging": {
        "outline": "#00FF00",  # æ˜ã‚‹ã„ç·‘
        "width": 2,
        "dash": (4, 2)
    },
    "confirmed": {
        "outline": "#FFC107",  # ã‚ªãƒ¬ãƒ³ã‚¸ï¼ˆæœªã‚·ãƒ³ã‚¯ï¼‰
        "width": 2,
        "dash": ()
    },
    "synced": {
        "outline": "#4CAF50",  # ç·‘ï¼ˆã‚·ãƒ³ã‚¯æ¸ˆã¿ï¼‰
        "width": 2,
        "dash": ()
    },
    "selected": {
        "outline": "#2196F3",  # é’ï¼ˆç·¨é›†ä¸­ï¼‰
        "width": 3,
        "dash": ()
    },
    "error": {
        "outline": "#F44336",  # èµ¤ï¼ˆã‚¨ãƒ©ãƒ¼ï¼‰
        "width": 2,
        "dash": (2, 2)
    }
}

def _update_region_appearance(self, region: EditableRegion):
    """é ˜åŸŸã®çŠ¶æ…‹ã«å¿œã˜ã¦è‰²ã‚’å¤‰æ›´"""
    if region.sync_number is not None:
        style = SELECTION_COLORS["synced"]
    elif region.text:
        style = SELECTION_COLORS["confirmed"]
    else:
        style = SELECTION_COLORS["error"]

    self.canvas.itemconfig(
        region.canvas_rect_id,
        outline=style["outline"],
        width=style["width"],
        dash=style["dash"]
    )
```

---

### ğŸ” å•é¡Œ2-D: OCRçµæœã®å³æ™‚è¡¨ç¤ºæ©Ÿèƒ½

#### ç—‡çŠ¶
é¸æŠå¾Œã€OCRçµæœãŒã©ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‹åˆ†ã‹ã‚‰ãªã„ã€‚

#### ç¾åœ¨ã®å®Ÿè£…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `advanced_comparison_view.py:2566-2570`

```python
# OCRå®Ÿè¡Œ
extracted_text = self._extract_text_from_region(rect, self._selection_source)

# âš ï¸ çµæœãŒã©ã“ã«ã‚‚è¡¨ç¤ºã•ã‚Œãªã„
# region.text ã«ä¿å­˜ã•ã‚Œã‚‹ã ã‘
```

#### è§£æ±ºç­–

**ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¡¨ç¤º**:

```python
class RegionTooltip:
    """é ˜åŸŸã«ãƒã‚¦ã‚¹ã‚ªãƒ¼ãƒãƒ¼ã§OCRçµæœã‚’è¡¨ç¤º"""

    def __init__(self, canvas: tk.Canvas):
        self.canvas = canvas
        self.tooltip_window = None

        canvas.bind("<Motion>", self._on_hover)

    def _on_hover(self, event):
        """ãƒã‚¦ã‚¹ãƒ›ãƒãƒ¼æ™‚ã«ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¡¨ç¤º"""
        x, y = event.x, event.y

        # ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã®é ˜åŸŸã‚’æ¤œå‡º
        region = self._get_region_at(x, y)

        if region and region.text:
            self._show_tooltip(event, region)
        else:
            self._hide_tooltip()

    def _show_tooltip(self, event, region: EditableRegion):
        """ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’è¡¨ç¤º"""
        if self.tooltip_window:
            self.tooltip_window.destroy()

        # å°ã•ãªãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦
        self.tooltip_window = tk.Toplevel(self.canvas)
        self.tooltip_window.wm_overrideredirect(True)
        self.tooltip_window.wm_geometry(f"+{event.x_root+10}+{event.y_root+10}")

        # ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º
        label = tk.Label(
            self.tooltip_window,
            text=region.text[:200] + ("..." if len(region.text) > 200 else ""),
            background="#FFFFCC",
            relief="solid",
            borderwidth=1,
            font=("Meiryo", 9),
            justify="left"
        )
        label.pack()
```

---

## å•é¡Œ3: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒœã‚¿ãƒ³ã¨æ©Ÿèƒ½ã®èª¬æ˜

### ğŸ“ å½±éŸ¿ã‚’å—ã‘ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«
- `app/gui/navigation.py` (ãƒœã‚¿ãƒ³UI)
- `app/gui/main_window_v2.py` (ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè£…)

---

### ğŸ¯ ãƒœã‚¿ãƒ³æ©Ÿèƒ½ãƒãƒˆãƒªãƒƒã‚¯ã‚¹

| # | ãƒœã‚¿ãƒ³å | ã‚¢ã‚¤ã‚³ãƒ³ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | å®Ÿè£…å ´æ‰€ | å‚™è€ƒ |
|---|---------|---------|------------|----------|------|
| 1 | **New Project** | âœ¨ | âœ… **å®Ÿè£…æ¸ˆã¿** | main_window_v2.py:302-312 | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ–°è¦ä½œæˆ |
| 2 | **Dashboard** | ğŸ“Š | âœ… **å®Ÿè£…æ¸ˆã¿** | main_window_v2.py:267-285 | ãƒã‚¯ãƒ­ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º |
| 3 | **Web Crawler** | ğŸŒ | ğŸŸ¡ **éƒ¨åˆ†å®Ÿè£…** | main_window_v2.py:507-561 | ãƒ­ãƒ¼ã‚«ãƒ«ç”»åƒã®ã¿å¯¾å¿œ |
| 4 | **Load PDFs** | ğŸ“ | âœ… **å®Ÿè£…æ¸ˆã¿** | main_window_v2.py:200-265 | PDF/ç”»åƒèª­ã¿è¾¼ã¿ |
| 5 | **Auto Match** | ğŸ”„ | âœ… **å®Ÿè£…æ¸ˆã¿** | main_window_v2.py:654-698 | è‡ªå‹•ãƒãƒƒãƒãƒ³ã‚° |
| 6 | **Gemini OCR** | ğŸ¤– | âœ… **å®Ÿè£…æ¸ˆã¿** | main_window_v2.py:700-774 | å˜ä½“OCRå®Ÿè¡Œ |
| 7 | **Export Excel** | ğŸ“Š | âŒ **æœªå®Ÿè£…** | main_window_v2.py:775-778 | ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ |
| 8 | **Save Project** | ğŸ’¾ | âŒ **æœªå®Ÿè£…** | main_window_v2.py:780-783 | ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ |
| 9 | **Load Project** | ğŸ“‚ | âŒ **æœªå®Ÿè£…** | ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å®šç¾©ã®ã¿ | ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ |
| 10 | **API Settings** | ğŸ” | âœ… **å®Ÿè£…æ¸ˆã¿** | main_window_v2.py:790-808 | APIè¨­å®šãƒ€ã‚¤ã‚¢ãƒ­ã‚° |

**å®Ÿè£…ç‡**: 60% (6/10 ãƒœã‚¿ãƒ³)

---

### ğŸ” å•é¡Œ3-A: Export Excel æ©Ÿèƒ½æœªå®Ÿè£…

#### ç—‡çŠ¶
ã€ŒExcel Exportã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€Œã“ã®æ©Ÿèƒ½ã¯å®Ÿè£…äºˆå®šã§ã™ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã€‚

#### ç¾åœ¨ã®å®Ÿè£…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `main_window_v2.py:775-778`

```python
def export_excel(self):
    """Excelå‡ºåŠ› (æœªå®Ÿè£…)"""
    messagebox.showinfo("æƒ…å ±", "ã“ã®æ©Ÿèƒ½ã¯å®Ÿè£…äºˆå®šã§ã™")
```

#### æœŸå¾…ã•ã‚Œã‚‹æ©Ÿèƒ½
- Web/PDF ã®OCRçµæœã‚’ Excel ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- ã‚·ãƒ³ã‚¯çµæœã‚’å«ã‚€æ¯”è¼ƒãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

#### è§£æ±ºç­–

**å®Ÿè£…ä¾‹**:

```python
def export_excel(self):
    """Excelå‡ºåŠ›"""
    try:
        from openpyxl import Workbook
        from openpyxl.styles import Font, PatternFill, Alignment
        from tkinter import filedialog
        from datetime import datetime

        # ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ãƒ€ã‚¤ã‚¢ãƒ­ã‚°
        filename = filedialog.asksaveasfilename(
            defaultextension=".xlsx",
            filetypes=[("Excel files", "*.xlsx")],
            initialfile=f"MEKIKI_Export_{datetime.now().strftime('%Y%m%d_%H%M%S')}.xlsx"
        )

        if not filename:
            return

        # Workbookä½œæˆ
        wb = Workbook()
        ws = wb.active
        ws.title = "Comparison Results"

        # ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œ
        headers = ["No", "Web ID", "Web Text", "PDF ID", "PDF Text", "Similarity", "Status"]
        for col, header in enumerate(headers, 1):
            cell = ws.cell(row=1, column=col, value=header)
            cell.font = Font(bold=True, color="FFFFFF")
            cell.fill = PatternFill(start_color="4CAF50", end_color="4CAF50", fill_type="solid")
            cell.alignment = Alignment(horizontal="center")

        # ãƒ‡ãƒ¼ã‚¿è¡Œ
        row = 2
        for web_region in self.web_regions:
            # å¯¾å¿œã™ã‚‹PDFé ˜åŸŸã‚’æ¤œç´¢
            pdf_region = None
            similarity = 0.0

            if web_region.sync_number is not None:
                for pdf_r in self.pdf_regions:
                    if pdf_r.sync_number == web_region.sync_number:
                        pdf_region = pdf_r
                        similarity = web_region.similarity
                        break

            # ãƒ‡ãƒ¼ã‚¿æ›¸ãè¾¼ã¿
            ws.cell(row, 1, row - 1)  # No
            ws.cell(row, 2, web_region.area_code)  # Web ID
            ws.cell(row, 3, web_region.text[:500])  # Web Text (500æ–‡å­—ã¾ã§)
            ws.cell(row, 4, pdf_region.area_code if pdf_region else "")  # PDF ID
            ws.cell(row, 5, pdf_region.text[:500] if pdf_region else "")  # PDF Text
            ws.cell(row, 6, f"{similarity*100:.1f}%")  # Similarity
            ws.cell(row, 7, "Matched" if pdf_region else "No Match")  # Status

            row += 1

        # åˆ—å¹…èª¿æ•´
        ws.column_dimensions['A'].width = 5
        ws.column_dimensions['B'].width = 15
        ws.column_dimensions['C'].width = 50
        ws.column_dimensions['D'].width = 15
        ws.column_dimensions['E'].width = 50
        ws.column_dimensions['F'].width = 12
        ws.column_dimensions['G'].width = 12

        # ä¿å­˜
        wb.save(filename)

        messagebox.showinfo(
            "Export Success",
            f"Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã—ã¾ã—ãŸ:\n{filename}\n\n"
            f"ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆä»¶æ•°: {row - 2} ä»¶"
        )

        # ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãï¼ˆWindowsï¼‰
        import os
        os.startfile(filename)

    except Exception as e:
        messagebox.showerror("Export Error", f"Excelå‡ºåŠ›ã‚¨ãƒ©ãƒ¼:\n{e}")
        logger.error(f"Excel export failed: {e}", exc_info=True)
```

**å¿…è¦ãªä¿®æ­£**:
- `navigation.py`: ãƒœã‚¿ãƒ³ã® `state="disabled"` ã‚’å‰Šé™¤
- `main_window_v2.py`: ä¸Šè¨˜ã®å®Ÿè£…ã‚’è¿½åŠ 

---

### ğŸ” å•é¡Œ3-B: Save/Load Project æ©Ÿèƒ½æœªå®Ÿè£…

#### ç—‡çŠ¶
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¿å­˜ãƒ»èª­ã¿è¾¼ã¿æ©Ÿèƒ½ãŒãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã®ã¿ã€‚

#### ç¾åœ¨ã®å®Ÿè£…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `main_window_v2.py:780-783`

```python
def save_project(self):
    """ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¿å­˜ (æœªå®Ÿè£…)"""
    messagebox.showinfo("æƒ…å ±", "ã“ã®æ©Ÿèƒ½ã¯å®Ÿè£…äºˆå®šã§ã™")
```

#### æœŸå¾…ã•ã‚Œã‚‹æ©Ÿèƒ½
- ç¾åœ¨ã®ä½œæ¥­çŠ¶æ…‹ï¼ˆWeb/PDFç”»åƒã€OCRçµæœã€ã‚·ãƒ³ã‚¯çµæœï¼‰ã‚’ä¿å­˜
- JSONå½¢å¼ã§ä¿å­˜ã—ã¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†é–‹å¯èƒ½

#### è§£æ±ºç­–

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ãƒ¼ã‚¿æ§‹é€ **:

```python
@dataclass
class ProjectData:
    """ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¿å­˜ãƒ‡ãƒ¼ã‚¿"""
    version: str = "1.0"
    created_at: str = ""
    updated_at: str = ""

    # ç”»åƒãƒ‘ã‚¹
    web_image_path: Optional[str] = None
    pdf_image_path: Optional[str] = None

    # é ˜åŸŸãƒ‡ãƒ¼ã‚¿
    web_regions: List[Dict] = field(default_factory=list)
    pdf_regions: List[Dict] = field(default_factory=list)

    # ã‚·ãƒ³ã‚¯ãƒ‡ãƒ¼ã‚¿
    sync_pairs: List[Dict] = field(default_factory=list)

    # è¨­å®š
    display_mode: str = "cover"
    selection_mode: str = "quick"
```

**ä¿å­˜å®Ÿè£…**:

```python
def save_project(self):
    """ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¿å­˜"""
    try:
        from tkinter import filedialog
        from datetime import datetime
        import json

        # ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ãƒ€ã‚¤ã‚¢ãƒ­ã‚°
        filename = filedialog.asksaveasfilename(
            defaultextension=".mekiki",
            filetypes=[("MEKIKI Project", "*.mekiki"), ("JSON", "*.json")],
            initialfile=f"Project_{datetime.now().strftime('%Y%m%d_%H%M%S')}.mekiki"
        )

        if not filename:
            return

        # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ãƒ¼ã‚¿åé›†
        project_data = {
            "version": "1.0",
            "created_at": datetime.now().isoformat(),
            "web_image_path": self.web_image_path,
            "pdf_image_path": self.pdf_image_path,
            "web_regions": [self._region_to_dict(r) for r in self.web_regions],
            "pdf_regions": [self._region_to_dict(r) for r in self.pdf_regions],
            "sync_pairs": [self._sync_to_dict(p) for p in self.sync_pairs],
            "display_mode": self._display_mode,
        }

        # JSONä¿å­˜
        with open(filename, 'w', encoding='utf-8') as f:
            json.dump(project_data, f, indent=2, ensure_ascii=False)

        messagebox.showinfo(
            "Save Success",
            f"ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸ:\n{filename}"
        )

    except Exception as e:
        messagebox.showerror("Save Error", f"ä¿å­˜ã‚¨ãƒ©ãƒ¼:\n{e}")
        logger.error(f"Project save failed: {e}", exc_info=True)

def _region_to_dict(self, region: EditableRegion) -> dict:
    """EditableRegion â†’ è¾æ›¸å¤‰æ›"""
    return {
        "id": region.id,
        "rect": region.rect,
        "text": region.text,
        "area_code": region.area_code,
        "sync_number": region.sync_number,
        "similarity": region.similarity,
        "source": region.source
    }
```

**èª­ã¿è¾¼ã¿å®Ÿè£…**:

```python
def load_project(self):
    """ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆèª­ã¿è¾¼ã¿"""
    try:
        from tkinter import filedialog
        import json
        from PIL import Image

        # ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°
        filename = filedialog.askopenfilename(
            filetypes=[("MEKIKI Project", "*.mekiki"), ("JSON", "*.json")]
        )

        if not filename:
            return

        # JSONèª­ã¿è¾¼ã¿
        with open(filename, 'r', encoding='utf-8') as f:
            project_data = json.load(f)

        # ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯
        if project_data.get("version") != "1.0":
            messagebox.showwarning(
                "Version Mismatch",
                f"ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ç•°ãªã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ä½œæˆã•ã‚Œã¦ã„ã¾ã™:\n{project_data.get('version')}"
            )

        # ç”»åƒèª­ã¿è¾¼ã¿
        if project_data.get("web_image_path"):
            web_img = Image.open(project_data["web_image_path"])
            self._load_web_image(web_img, project_data["web_image_path"])

        if project_data.get("pdf_image_path"):
            pdf_img = Image.open(project_data["pdf_image_path"])
            self._load_pdf_image(pdf_img, project_data["pdf_image_path"])

        # é ˜åŸŸå¾©å…ƒ
        self.web_regions = [self._dict_to_region(r) for r in project_data.get("web_regions", [])]
        self.pdf_regions = [self._dict_to_region(r) for r in project_data.get("pdf_regions", [])]

        # ã‚·ãƒ³ã‚¯çµæœå¾©å…ƒ
        self.sync_pairs = project_data.get("sync_pairs", [])

        # UIæ›´æ–°
        self._display_mode = project_data.get("display_mode", "cover")
        self._redraw_all()

        messagebox.showinfo(
            "Load Success",
            f"ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ:\n{filename}\n\n"
            f"Webé ˜åŸŸ: {len(self.web_regions)} ä»¶\n"
            f"PDFé ˜åŸŸ: {len(self.pdf_regions)} ä»¶"
        )

    except Exception as e:
        messagebox.showerror("Load Error", f"èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:\n{e}")
        logger.error(f"Project load failed: {e}", exc_info=True)
```

---

### ğŸ” å•é¡Œ3-C: Web Crawler ã® URL ã‚¯ãƒ­ãƒ¼ãƒ«æœªå®Ÿè£…

#### ç—‡çŠ¶
ã€ŒWeb Crawlerã€ãƒœã‚¿ãƒ³ã¯ãƒ­ãƒ¼ã‚«ãƒ«ç”»åƒé¸æŠã®ã¿å¯¾å¿œã§ã€URL ã‹ã‚‰ã®ã‚¯ãƒ­ãƒ¼ãƒ«ãŒã§ããªã„ã€‚

#### ç¾åœ¨ã®å®Ÿè£…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `main_window_v2.py:507-561`

```python
def crawl_web(self):
    """Web ã‚¯ãƒ­ãƒ¼ãƒ« (ç¾åœ¨ã¯ãƒ­ãƒ¼ã‚«ãƒ«ç”»åƒé¸æŠã®ã¿)"""
    # Line 518: ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    messagebox.showinfo("æƒ…å ±", "URLã‚¯ãƒ­ãƒ¼ãƒ«æ©Ÿèƒ½ã¯å®Ÿè£…äºˆå®šã§ã™")
```

#### æœŸå¾…ã•ã‚Œã‚‹æ©Ÿèƒ½
- URLã‚’å…¥åŠ›ã—ã¦Webãƒšãƒ¼ã‚¸ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆå–å¾—
- Playwright ã‚’ä½¿ç”¨ã—ãŸè‡ªå‹•ã‚¯ãƒ­ãƒ¼ãƒ«

#### è§£æ±ºç­–

**URL ã‚¯ãƒ­ãƒ¼ãƒ«å®Ÿè£…**:

```python
def crawl_web(self):
    """Web ã‚¯ãƒ­ãƒ¼ãƒ«"""
    from app.gui.dialogs.url_input_dialog import URLInputDialog

    # URLå…¥åŠ›ãƒ€ã‚¤ã‚¢ãƒ­ã‚°
    dialog = URLInputDialog(self)
    dialog.wait_window()

    if dialog.url:
        self._crawl_url(dialog.url)
    else:
        # ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚ã¯ãƒ­ãƒ¼ã‚«ãƒ«ç”»åƒé¸æŠ
        self._select_local_web_image()

def _crawl_url(self, url: str):
    """URLã‹ã‚‰ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆå–å¾—"""
    try:
        from playwright.sync_api import sync_playwright
        from PIL import Image
        import io

        # ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤º
        self.nav_panel.show_progress("Webãƒšãƒ¼ã‚¸ã‚’èª­ã¿è¾¼ã¿ä¸­...")

        with sync_playwright() as p:
            # ãƒ–ãƒ©ã‚¦ã‚¶èµ·å‹•
            browser = p.chromium.launch(headless=True)
            page = browser.new_page(viewport={"width": 1920, "height": 1080})

            # ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿
            page.goto(url, wait_until="networkidle")

            # ãƒ•ãƒ«ãƒšãƒ¼ã‚¸ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ
            screenshot_bytes = page.screenshot(full_page=True)

            # PIL Image ã«å¤‰æ›
            web_image = Image.open(io.BytesIO(screenshot_bytes))

            browser.close()

        # ç”»åƒèª­ã¿è¾¼ã¿
        self.web_image = web_image
        self.web_image_path = url

        # Canvas ã«è¡¨ç¤º
        self._display_image_smart(self.web_canvas, web_image, "web")

        self.nav_panel.hide_progress()

        messagebox.showinfo(
            "Success",
            f"Webãƒšãƒ¼ã‚¸ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ:\n{url}\n\n"
            f"ã‚µã‚¤ã‚º: {web_image.width} x {web_image.height} px"
        )

    except Exception as e:
        self.nav_panel.hide_progress()
        messagebox.showerror("Crawl Error", f"URLã‚¯ãƒ­ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼:\n{e}")
        logger.error(f"URL crawl failed: {e}", exc_info=True)
```

**URLå…¥åŠ›ãƒ€ã‚¤ã‚¢ãƒ­ã‚°**:

```python
# app/gui/dialogs/url_input_dialog.py
import customtkinter as ctk

class URLInputDialog(ctk.CTkToplevel):
    """URLå…¥åŠ›ãƒ€ã‚¤ã‚¢ãƒ­ã‚°"""

    def __init__(self, parent):
        super().__init__(parent)

        self.url = None

        self.title("Web Crawler")
        self.geometry("500x200")
        self.transient(parent)
        self.grab_set()

        # ã‚¿ã‚¤ãƒˆãƒ«
        ctk.CTkLabel(
            self,
            text="Webãƒšãƒ¼ã‚¸ã‚’ã‚¯ãƒ­ãƒ¼ãƒ«",
            font=("Meiryo", 16, "bold")
        ).pack(pady=20)

        # URLå…¥åŠ›
        ctk.CTkLabel(self, text="URL:").pack(anchor="w", padx=20)

        self.url_entry = ctk.CTkEntry(self, width=400)
        self.url_entry.pack(padx=20, pady=5)
        self.url_entry.insert(0, "https://")
        self.url_entry.focus()

        # ãƒœã‚¿ãƒ³
        btn_frame = ctk.CTkFrame(self, fg_color="transparent")
        btn_frame.pack(pady=20)

        ctk.CTkButton(
            btn_frame,
            text="ã‚¯ãƒ­ãƒ¼ãƒ«",
            command=self._on_crawl,
            width=100
        ).pack(side="left", padx=5)

        ctk.CTkButton(
            btn_frame,
            text="ã‚­ãƒ£ãƒ³ã‚»ãƒ«",
            command=self.destroy,
            width=100,
            fg_color="#666666"
        ).pack(side="left", padx=5)

    def _on_crawl(self):
        url = self.url_entry.get().strip()
        if url and url.startswith("http"):
            self.url = url
            self.destroy()
        else:
            from tkinter import messagebox
            messagebox.showwarning("Invalid URL", "æœ‰åŠ¹ãªURLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„")
```

---

## æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³

### ğŸ¯ å„ªå…ˆåº¦ãƒãƒˆãƒªãƒƒã‚¯ã‚¹

| å„ªå…ˆåº¦ | ã‚¿ã‚¹ã‚¯ | å·¥æ•° | å½±éŸ¿åº¦ | ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤ |
|--------|--------|------|--------|-------------|
| **P0** | ç”»åƒã‚ªãƒ•ã‚»ãƒƒãƒˆä¿®æ­£ | 2h | ğŸ”´ High | â˜…â˜…â˜…â˜…â˜… |
| **P0** | ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³é ˜åŸŸç·¨é›†å®Ÿè£… | 8h | ğŸ”´ High | â˜…â˜…â˜…â˜…â˜… |
| **P1** | Export Excel å®Ÿè£… | 4h | ğŸŸ¡ Medium | â˜…â˜…â˜…â˜…â˜† |
| **P1** | ãƒªã‚µã‚¤ã‚º Debounce æœ€é©åŒ– | 1h | ğŸŸ¡ Medium | â˜…â˜…â˜…â˜†â˜† |
| **P2** | Save/Load Project å®Ÿè£… | 6h | ğŸŸ¡ Medium | â˜…â˜…â˜…â˜…â˜† |
| **P2** | URL ã‚¯ãƒ­ãƒ¼ãƒ«å®Ÿè£… | 6h | ğŸŸ¡ Medium | â˜…â˜…â˜…â˜†â˜† |
| **P3** | é ˜åŸŸå†æç”»ã®å·®åˆ†æ›´æ–° | 4h | ğŸŸ¢ Low | â˜…â˜…â˜†â˜†â˜† |
| **P3** | é¸æŠãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿UI | 2h | ğŸŸ¢ Low | â˜…â˜…â˜†â˜†â˜† |

**åˆè¨ˆå·¥æ•°**: 33æ™‚é–“ï¼ˆç´„4-5å–¶æ¥­æ—¥ï¼‰

---

### ğŸ“… å®Ÿè£…ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

#### **Phase 1: ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ä¿®æ­£ï¼ˆ1æ—¥ï¼‰**
- [ ] ç”»åƒã‚ªãƒ•ã‚»ãƒƒãƒˆä¿®æ­£ï¼ˆ2hï¼‰
- [ ] ãƒªã‚µã‚¤ã‚º Debounce æœ€é©åŒ–ï¼ˆ1hï¼‰
- [ ] åº§æ¨™å¤‰æ›ã‚·ã‚¹ãƒ†ãƒ ã®çµ±ä¸€ï¼ˆ3hï¼‰
- [ ] ãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼ï¼ˆ2hï¼‰

#### **Phase 2: ã‚³ã‚¢æ©Ÿèƒ½å®Ÿè£…ï¼ˆ2æ—¥ï¼‰**
- [ ] ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³é ˜åŸŸç·¨é›†å®Ÿè£…ï¼ˆ8hï¼‰
  - ãƒãƒ³ãƒ‰ãƒ«è¡¨ç¤º
  - ãƒ‰ãƒ©ãƒƒã‚°ç§»å‹•ãƒ»ãƒªã‚µã‚¤ã‚º
  - å‰Šé™¤æ©Ÿèƒ½
- [ ] Export Excel å®Ÿè£…ï¼ˆ4hï¼‰
- [ ] ãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼ï¼ˆ2hï¼‰

#### **Phase 3: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ï¼ˆ1-2æ—¥ï¼‰**
- [ ] Save Project å®Ÿè£…ï¼ˆ3hï¼‰
- [ ] Load Project å®Ÿè£…ï¼ˆ3hï¼‰
- [ ] ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼å®šç¾©ï¼ˆ1hï¼‰
- [ ] ãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼ï¼ˆ2hï¼‰

#### **Phase 4: è¿½åŠ æ©Ÿèƒ½ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰**
- [ ] URL ã‚¯ãƒ­ãƒ¼ãƒ«å®Ÿè£…ï¼ˆ6hï¼‰
- [ ] é¸æŠãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿UIï¼ˆ2hï¼‰
- [ ] é ˜åŸŸå†æç”»æœ€é©åŒ–ï¼ˆ4hï¼‰

---

### ğŸ§ª ãƒ†ã‚¹ãƒˆè¨ˆç”»

#### **å˜ä½“ãƒ†ã‚¹ãƒˆ**
```python
# test_coordinate_transform.py
def test_cover_mode_offset():
    """Coverãƒ¢ãƒ¼ãƒ‰ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆè¨ˆç®—ãƒ†ã‚¹ãƒˆ"""
    transform = UnifiedCoordinateTransform(
        source_size=(1000, 1000),
        canvas_size=(800, 600),
        mode="cover"
    )

    # æœŸå¾…ã•ã‚Œã‚‹ã‚¹ã‚±ãƒ¼ãƒ«: max(800/1000, 600/1000) = 0.8
    assert transform.scale == 0.8

    # æœŸå¾…ã•ã‚Œã‚‹ã‚ªãƒ•ã‚»ãƒƒãƒˆ: (800 - 800) / 2 = 0, (800 - 600) / 2 = 100
    assert transform.offset_x == 0
    assert transform.offset_y == 100

def test_inline_edit_resize():
    """ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†ã®ãƒªã‚µã‚¤ã‚ºãƒ†ã‚¹ãƒˆ"""
    editor = InlineRegionEditor(canvas)

    region = EditableRegion(
        id=1,
        rect=[100, 100, 200, 200],
        text="Test"
    )

    editor._select_region(region)
    editor._resize_region("se", dx=50, dy=50)

    # å³ä¸‹ãƒãƒ³ãƒ‰ãƒ«ã‚’50pxç§»å‹• â†’ rect ãŒæ‹¡å¤§
    assert region.rect == [100, 100, 250, 250]
```

#### **çµ±åˆãƒ†ã‚¹ãƒˆ**
- [ ] Web/PDF ç”»åƒèª­ã¿è¾¼ã¿ â†’ è¡¨ç¤º â†’ é ˜åŸŸé¸æŠ â†’ ã‚·ãƒ³ã‚¯ â†’ Export
- [ ] ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¿å­˜ â†’ ã‚¢ãƒ—ãƒªå†èµ·å‹• â†’ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆèª­ã¿è¾¼ã¿ â†’ çŠ¶æ…‹å¾©å…ƒç¢ºèª
- [ ] 1000é ˜åŸŸã§ã®é ˜åŸŸå†æç”»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ï¼ˆç›®æ¨™: <300msï¼‰

#### **E2Eãƒ†ã‚¹ãƒˆ**
- [ ] å®Ÿéš›ã®Webãƒšãƒ¼ã‚¸ã¨PDFã§å®Œå…¨ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œ
- [ ] Excelã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆçµæœã®å¦¥å½“æ€§ç¢ºèª
- [ ] è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã®æ“ä½œæ€§ãƒ†ã‚¹ãƒˆ

---

## ä»˜éŒ²: å½±éŸ¿ã‚’å—ã‘ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

### ğŸ”§ ä¿®æ­£ãŒå¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | è¡Œæ•° | ä¿®æ­£å†…å®¹ | å„ªå…ˆåº¦ |
|---------|------|----------|--------|
| `app/gui/windows/advanced_comparison_view.py` | 3046 | ã‚ªãƒ•ã‚»ãƒƒãƒˆé©ç”¨ã€ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†å®Ÿè£… | P0 |
| `app/sdk/canvas/transform.py` | 301 | çµ±ä¸€åº§æ¨™å¤‰æ›ã‚·ã‚¹ãƒ†ãƒ  | P0 |
| `app/gui/main_window_v2.py` | 808 | Export/Save/Load å®Ÿè£… | P1 |
| `app/gui/navigation.py` | 134 | é¸æŠãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿UI | P3 |

### ğŸ“„ æ–°è¦ä½œæˆãŒå¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | ç›®çš„ | å„ªå…ˆåº¦ |
|---------|------|--------|
| `app/gui/widgets/inline_region_editor.py` | ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³é ˜åŸŸç·¨é›† | P0 |
| `app/gui/dialogs/url_input_dialog.py` | URLå…¥åŠ›ãƒ€ã‚¤ã‚¢ãƒ­ã‚° | P2 |
| `app/utils/project_serializer.py` | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¿å­˜ãƒ»èª­ã¿è¾¼ã¿ | P2 |
| `app/core/coordinate_system.py` | çµ±ä¸€åº§æ¨™å¤‰æ› | P0 |

### ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°

- [ ] `README.md`: æ–°æ©Ÿèƒ½ã®ä½¿ç”¨æ–¹æ³•è¿½åŠ 
- [ ] `DEPLOYMENT.md`: ãƒ†ã‚¹ãƒˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆæ›´æ–°
- [ ] `USER_GUIDE.md`: ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆä»˜ããƒãƒ‹ãƒ¥ã‚¢ãƒ«ä½œæˆ

---

## ã¾ã¨ã‚

### âœ… ä¸»è¦ãªç™ºè¦‹
1. **ç”»åƒã‚ªãƒ•ã‚»ãƒƒãƒˆè¨ˆç®—ã®ãƒã‚°**: Coverãƒ¢ãƒ¼ãƒ‰ã§ä¸­å¤®é…ç½®ã•ã‚Œãªã„è‡´å‘½çš„ãªå•é¡Œ
2. **ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†æ©Ÿèƒ½ã®æ¬ å¦‚**: ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ã‚’å¤§ããæãªã†
3. **ä¸»è¦æ©Ÿèƒ½ã®æœªå®Ÿè£…**: Export/Save/Load ãŒãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼

### ğŸ¯ ãƒ“ã‚¸ãƒã‚¹ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ
- **ç¾çŠ¶**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ç”»åƒã®ã‚ºãƒ¬ã¨ç·¨é›†ã®ä¸ä¾¿ã•ã«ä¸æº€
- **æ”¹å–„å¾Œ**: ç›´æ„Ÿçš„ãªæ“ä½œã§ä½œæ¥­åŠ¹ç‡ãŒ3-5å€å‘ä¸Š
- **æŠ•è³‡å¯¾åŠ¹æœ**: 33æ™‚é–“ã®å·¥æ•°ã§ä¸»è¦ãªä½¿ã„ã‚„ã™ã•å•é¡Œã‚’è§£æ±º

### ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—
1. ã“ã®ãƒ¬ãƒãƒ¼ãƒˆã‚’ã‚¹ãƒ†ãƒ¼ã‚¯ãƒ›ãƒ«ãƒ€ãƒ¼ã¨å…±æœ‰
2. Phase 1ï¼ˆã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ä¿®æ­£ï¼‰ã‚’æœ€å„ªå…ˆã§å®Ÿæ–½
3. Phase 2ï¼ˆã‚³ã‚¢æ©Ÿèƒ½ï¼‰ã‚’1é€±é–“ä»¥å†…ã«å®Œäº†
4. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ†ã‚¹ãƒˆã§æ¤œè¨¼å¾Œã«ãƒªãƒªãƒ¼ã‚¹

---

**ãƒ¬ãƒãƒ¼ãƒˆä½œæˆè€…**: MEKIKI Development Team
**æ‰¿èªå¾…ã¡**: Product Owner / Tech Lead
**æ¬¡å›ãƒ¬ãƒ“ãƒ¥ãƒ¼**: å®Ÿè£…å®Œäº†å¾Œ

---

## ä»˜éŒ²: ã‚³ãƒ¼ãƒ‰ã‚¹ãƒ‹ãƒšãƒƒãƒˆé›†

### A. ç”»åƒã‚ªãƒ•ã‚»ãƒƒãƒˆä¿®æ­£ï¼ˆå³åº§ã«é©ç”¨å¯èƒ½ï¼‰

```python
# File: app/gui/windows/advanced_comparison_view.py
# Line: 1328

# ä¿®æ­£å‰
canvas.create_image(0, 0, anchor="nw", image=photo, tags="image")

# ä¿®æ­£å¾Œ
canvas.create_image(-offset_x, -offset_y, anchor="nw", image=photo, tags="image")
```

### B. Debounceæ™‚é–“çŸ­ç¸®ï¼ˆå³åº§ã«é©ç”¨å¯èƒ½ï¼‰

```python
# File: app/gui/windows/advanced_comparison_view.py
# Line: 680

# ä¿®æ­£å‰
self._resize_job = self.after(300, lambda: self._do_resize(event))

# ä¿®æ­£å¾Œ
self._resize_job = self.after(150, lambda: self._do_resize(event))
```

### C. ã‚µã‚¤ã‚ºå¤‰åŒ–é–¾å€¤ç·©å’Œï¼ˆå³åº§ã«é©ç”¨å¯èƒ½ï¼‰

```python
# File: app/gui/windows/advanced_comparison_view.py
# Lines: 686-690

# ä¿®æ­£å‰
if abs(new_w - last_w) < 10 and abs(new_h - last_h) < 10:
    return

# ä¿®æ­£å¾Œ
if abs(new_w - last_w) < 5 and abs(new_h - last_h) < 5:
    return
```

---

**End of Report**
