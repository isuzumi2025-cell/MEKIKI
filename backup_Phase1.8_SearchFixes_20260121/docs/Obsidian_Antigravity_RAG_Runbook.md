# プロジェクト横断 RAG & マルチエージェント開発 Runbook

**統合元**: `RUNBOOK.md`の知見を継承

---

## 🚨 エージェント行動原則

> **全AIエージェントはこれらの原則を遵守すること**

1. **根本解決優先**: 問題アーキテクチャに追加実装しない。置き換える
2. **結果追及型**: 見かけの進捗より実際の問題解決を優先
3. **処理順序遵守**: ユーザー指定の処理順序を変更しない
4. **理解確認義務**: 実装前にRUNBOOKと会話ログを参照

---

## ⚠️ CORE FILE PROTECTION

| ファイル | 理由 | 変更時 |
|---------|------|--------|
| `engine_cloud.py` | OCRクラスタリング | 必ずバックアップ |
| `sync_matcher.py` | マッチングロジック | Match数確認 |
| `paragraph_matcher.py` | パラグラフ比較 | 復元準備 |

---

## マルチエージェント構成

```
Obsidian Vault (RAG)
       ↓
┌──────────────┬──────────────┬──────────────┐
│ Antigravity  │ Claude Code  │ ChatGPT等    │
│ 実装/デバッグ │ 設計/リファクタ │ 調査/文書     │
└──────────────┴──────────────┴──────────────┘
```

| エージェント | 得意 | 使用シーン |
|-------------|------|-----------|
| **Antigravity** | ファイル操作・実装 | バグ修正、機能追加 |
| **Claude Code** | 大規模リファクタ | アーキ設計レビュー |

---

## パラグラフ検出問題 (現在)

### 原因
- Cloud Vision APIブロックが細かすぎる
- クラスタリングパラメータ調整が困難

### 解決策

#### A. 厳格設定を維持 (推奨)
```python
# Match:70達成時の設定 (backup_20260112_004423)
overlap_ratio > 0.6   # 厳格
left_diff < 30        # 厳格
threshold_y = max(base_size * 2.5, 50)
gap_x > 15            # 厳格
```

#### B. LLMパラグラフ生成
```
OCR全文抽出 → LLMでセマンティック分割 → 座標マッピング
```

---

## 開発フロー

1. **設計** (Claude Code): 要件整理→アーキ議論
2. **実装** (Antigravity): コード作成→自動テスト
3. **記録** (Obsidian): 変更履歴→ナレッジ更新

---

## 次のアクション

1. [ ] LLMパラグラフ分割実装 (`llm_segmenter.py`)
2. [ ] Claude Codeでアーキレビュー
3. [ ] Obsidian Vault構造整備
